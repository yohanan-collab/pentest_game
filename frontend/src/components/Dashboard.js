import React, { useState, useEffect } from 'react';
import { FaBars, FaUser, FaComments, FaGamepad, FaUsers, FaBook, FaTools } from 'react-icons/fa';
import ChatForum from './ChatForum';
import GameEnvironment from './GameEnvironment';
import Multiplayer from './Multiplayer';
import NarrativeComponent from './NarrativeComponent';
import PentestTools from './PentestTools';
import Profil from './Profil';
import axios from 'axios';
import '../styles/Dashboard.css';

const Dashboard = () => {
  const [isNavOpen, setIsNavOpen] = useState(false);
  const [activeComponent, setActiveComponent] = useState('Profil');

  const [userData, setUser] = useState(null);

  useEffect(() => {
    const fetchUserProfile = async () => {
      try {
        const userId = localStorage.getItem('sessionId');
        const response = await axios.get(`http://localhost:5000/api/users`);
  
        // Vérifiez si l'ID de l'utilisateur dans la réponse est le même que celui stocké localement
        if (response.data._id === userId) {
          setUser(response.data);
        } else {
          console.error('User ID mismatch');
        }
      } catch (error) {
        console.error('Error fetching user profile:', error);
      }
    };
  
    fetchUserProfile();
  }, []);

  const toggleNav = () => {
    setIsNavOpen(!isNavOpen);
  };

  const renderComponent = () => {
    switch (activeComponent) {
      case 'ChatForum':
        return <ChatForum />;
      case 'GameEnvironment':
        return <GameEnvironment />;
      case 'Multiplayer':
        return <Multiplayer />;
      case 'NarrativeComponent':
        return <NarrativeComponent />;
      case 'PentestTools':
        return <PentestTools />;
      default:
        return (
          <Profil
            username={userData ? userData.username : ''}
            email={userData ? userData.email : ''}
            progress={userData ? userData.progress : 0}
            level={userData ? userData.level : 0}
            experience={userData ? userData.experience : 0}
            rank={userData ? userData.rank : ''}
            achievements={userData ? userData.achievements : []}
          />
        ); // Default Profile content
    }
  };

  return (
    <div className="dashboard-container">
      <div className={`navbar ${isNavOpen ? 'open' : 'closed'}`}>
        <div className="menu-icon" onClick={toggleNav}>
          <FaBars />
        </div>
        {isNavOpen && <h2 className="menu-title">Menu</h2>}
        <ul>
          <li onClick={() => setActiveComponent('Profil')}>
            <FaUser className="icon" />
            {isNavOpen && <span className="menu-item">Profile</span>}
          </li>
          <li onClick={() => setActiveComponent('ChatForum')}>
            <FaComments className="icon" />
            {isNavOpen && <span className="menu-item">Chat Forum</span>}
          </li>
          <li onClick={() => setActiveComponent('GameEnvironment')}>
            <FaGamepad className="icon" />
            {isNavOpen && <span className="menu-item">Game Environment</span>}
          </li>
          <li onClick={() => setActiveComponent('Multiplayer')}>
            <FaUsers className="icon" />
            {isNavOpen && <span className="menu-item">Multiplayer</span>}
          </li>
          <li onClick={() => setActiveComponent('NarrativeComponent')}>
            <FaBook className="icon" />
            {isNavOpen && <span className="menu-item">Narrative</span>}
          </li>
          <li onClick={() => setActiveComponent('PentestTools')}>
            <FaTools className="icon" />
            {isNavOpen && <span className="menu-item">Pentest Tools</span>}
          </li>
        </ul>
      </div>
      <div className={`dashboard ${isNavOpen ? 'nav-open' : 'nav-closed'}`}>
        {renderComponent()}
      </div>
    </div>
  );
};

export default Dashboard;
