// controllers/profileController.js
const Profile = require('../models/ProfilModel');

exports.getProfileByUserId = async (req, res) => {
  try {
    const profile = await Profile.findOne({ userId: req.params.userId });
    if (!profile) {
      return res.status(404).json({ msg: 'Profile not found' });
    }
    res.json(profile);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
};

exports.updateProfileByUserId = async (req, res) => {
  const { profilePicture, progress, level, experience, rank, achievements } = req.body;

  try {
    let profile = await Profile.findOne({ userId: req.params.userId });

    if (!profile) {
      return res.status(404).json({ msg: 'Profile not found' });
    }

    profile.profilePicture = profilePicture || profile.profilePicture;
    profile.progress = progress !== undefined ? progress : profile.progress;
    profile.level = level !== undefined ? level : profile.level;
    profile.experience = experience !== undefined ? experience : profile.experience;
    profile.rank = rank || profile.rank;
    profile.achievements = achievements || profile.achievements;

    await profile.save();

    res.json(profile);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
};
